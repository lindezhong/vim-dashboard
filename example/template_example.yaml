# Jinja2 模板引擎示例配置
# 展示所有支持的参数类型和模板语法功能

database:
  type: sqlite
  url: "sqlite:///:memory:"

# 查询配置 - 包含SQL模板和参数定义
query:
  # 参数定义 - 支持多种数据类型和默认值
  args:
    # 字符串参数
    - name: user_status
      type: string
      default: "active"
      description: "用户状态过滤条件"

    # 数字参数
    - name: min_age
      type: number
      default: 18
      description: "最小年龄"

    - name: max_age
      type: number
      default: 65
      description: "最大年龄"

    # 布尔参数
    - name: include_deleted
      type: boolean
      default: false
      description: "是否包含已删除用户"

    # 列表参数
    - name: departments
      type: list
      default: ["IT", "HR", "Finance"]
      description: "部门列表"

    - name: user_ids
      type: list
      default: [1, 2, 3]
      description: "用户ID列表"

    # Map参数
    - name: filters
      type: map
      default:
        region: "Asia"
        level: "senior"
      description: "额外过滤条件"

    # 可选参数（无默认值）
    - name: search_keyword
      type: string
      description: "搜索关键词（可选）"

  # 使用Jinja2模板语法的SQL查询 - SQLite内存数据库示例
  sql: |
    WITH sample_users AS (
      SELECT 1 as id, 'Alice' as name, 25 as age, 'IT' as department, 
             '{{ user_status }}' as status, datetime('now', '-30 days') as created_at
      UNION ALL
      SELECT 2, 'Bob', 32, 'HR', 'active', datetime('now', '-25 days')
      UNION ALL  
      SELECT 3, 'Charlie', 28, 'Finance', 'inactive', datetime('now', '-20 days')
      UNION ALL
      SELECT 4, 'Diana', 35, 'IT', 'active', datetime('now', '-15 days')
      UNION ALL
      SELECT 5, 'Eve', 29, 'HR', 'active', datetime('now', '-10 days')
      UNION ALL
      SELECT 6, 'Frank', 42, 'Finance', 'inactive', datetime('now', '-5 days')
      UNION ALL
      SELECT 7, 'Grace', 26, 'IT', 'active', datetime('now', '-2 days')
    )
    SELECT 
      u.id,
      u.name,
      u.age,
      u.department,
      u.status,
      u.created_at,
      '{{ search_keyword | default("") }}' as search_term
    FROM sample_users u
    WHERE 1=1
      {%- if user_status %}
      AND u.status = {{ user_status | sql_quote }}
      {%- endif %}
      
      {%- if min_age is defined %}
      AND u.age >= {{ min_age }}
      {%- endif %}
      
      {%- if max_age is defined %}
      AND u.age <= {{ max_age }}
      {%- endif %}
      
      {%- if departments and departments|length > 0 %}
      AND u.department IN {{ departments | sql_in }}
      {%- endif %}
      
      {%- if user_ids and user_ids|length > 0 %}
      AND u.id IN {{ user_ids | sql_in }}
      {%- endif %}
      
      {%- if filters %}
        {%- for key, value in filters.items() %}
          {%- if key == 'region' %}
      -- 模拟区域过滤 (示例)
      AND '{{ value }}' = 'Asia'
          {%- elif key == 'level' %}
      -- 模拟级别过滤 (示例)  
      AND '{{ value }}' IN ('senior', 'junior')
          {%- endif %}
        {%- endfor %}
      {%- endif %}
      
      {%- if search_keyword %}
      AND (u.name LIKE {{ ('%' + search_keyword + '%') | sql_quote }}
           OR u.department LIKE {{ ('%' + search_keyword + '%') | sql_quote }})
      {%- endif %}
    
    ORDER BY u.created_at DESC
    LIMIT {{ 100 if not filters.get('limit') else filters.limit }}

interval: 30s

show:
  type: table
  column_list:
    - column: id
      alias: "用户ID"
    - column: name
      alias: "姓名"
    - column: age
      alias: "年龄"
    - column: department
      alias: "部门"
    - column: status
      alias: "状态"
    - column: created_at
      alias: "创建时间"